{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PraxisPilot Domain Events",
  "description": "Canonical event schema. Events are immutable, append-only.",
  "schema_version": "1",
  "required_envelope": ["event_id", "timestamp", "actor", "entity_type", "entity_id", "event_type", "payload", "source", "schema_version"],
  "event_types": {
    "ai_response.created": {
      "description": "AI markdown response processed and stored",
      "payload": {
        "raw_markdown": "string",
        "structured_blocks": "array",
        "model": "string",
        "confidence": "number",
        "version": "number"
      }
    },
    "ai_response.action_executed": {
      "description": "User executed an AI-recommended action",
      "payload": {
        "command": "string",
        "label": "string",
        "confidence": "number"
      }
    },
    "ai_response.sanitization_failed": {
      "description": "Markdown sanitization rejected unsafe content",
      "payload": {
        "reason": "string"
      }
    },
    "ai_response.regenerated": {
      "description": "AI response was regenerated; new version created",
      "payload": {
        "previous_version": "number",
        "new_version": "number"
      }
    },
    "folder.created": {
      "description": "Folder created",
      "payload": {
        "folder_id": "string",
        "name": "string"
      }
    },
    "folder.renamed": {
      "description": "Folder renamed (no PII in payload)",
      "payload": {
        "folder_id": "string"
      }
    },
    "folder.deleted": {
      "description": "Folder deleted; chats moved to Unfiled",
      "payload": {
        "folder_id": "string",
        "chats_moved": "number"
      }
    },
    "chat.folder_changed": {
      "description": "Chat assigned to different folder",
      "payload": {
        "chat_id": "string",
        "old_folder_id": "string|null",
        "new_folder_id": "string|null"
      }
    },
    "chat.finalized": {
      "description": "Chat locked/finalized for medico-legal documentation; no further modifications allowed",
      "payload": {
        "chat_id": "string"
      }
    },
    "structured_document.created": {
      "description": "Structured session document created (manual or generated)",
      "payload": {
        "document_id": "string",
        "conversation_id": "string",
        "version": "number"
      }
    },
    "structured_document.updated": {
      "description": "Structured session document content updated",
      "payload": {
        "document_id": "string",
        "conversation_id": "string",
        "version": "number"
      }
    },
    "structured_document.versioned": {
      "description": "New version of structured document saved",
      "payload": {
        "document_id": "string",
        "conversation_id": "string",
        "version": "number"
      }
    },
    "structured_document.generated": {
      "description": "Structured document generated from conversation via LLM",
      "payload": {
        "document_id": "string",
        "conversation_id": "string",
        "version": "number"
      }
    },
    "structured_document.validation_failed": {
      "description": "LLM output for structured document failed schema validation",
      "payload": {
        "conversation_id": "string",
        "reason": "string"
      }
    },
    "intervention_suggested": {
      "description": "Intervention suggestion shown to user (no PII)",
      "payload": {
        "intervention_id": "string",
        "category": "string"
      }
    },
    "intervention_viewed": {
      "description": "User viewed intervention library entry (no PII)",
      "payload": {
        "intervention_id": "string",
        "category": "string"
      }
    }
  }
}
